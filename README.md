# Auxo-Reporter

Largely derived from the existing Pie Reporter, this repository contains the scripts used to compute the rewards for veAUXO and xAUXO holders.

## Structure

```sh
merkleTree/     # Typescript MerkleTree generator with OpenZeppelin
reporter/       # Python application to parse config data into rewards database
reports/        # Output files relating to claims, voting, proposals, rewards and the final tree
```

## Installation

Make sure you have Python, Pip, NodeJS, Yarn installed. Python 3.10+ is recommended.

The [Makefile](./Makefile) contains a set of scripts to get you started. Provided you have `make` installed:

Setup the python venv and activate:

```sh
make venv
source venv/bin/activate
```

Install everything :

```sh
make setup
```

Check for type errors and format everything:

```sh
make lint
```

Run unit tests

```sh
make test
```

## Running the Application

Everything is built from a single config file:

```json
{
  "year": 2023, // must be YYYY
  "month": 1, // must be MM or M
  "block_snapshot": 16086234, // block to check stakers
  "distribution_window": 14, // increment previous window by 1
  "rewards":
    // total rewards to distribute to all stakers
    {
      "token": "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
      "amount": "509976000000000000000000",
      "decimals": 18,
      "symbol": "WETH"
    }
}
```

Create the database of claims and rewards:

```sh
make claims
```

If all goes well, you should have a new folder `reports/{year}-{month}/`, i.e. `reports/2022-11/`.

In it you will have the following files

```sh
csv/                  # Report data in CSV format
json/                 # Report data in JSON format
claims.json           # Rewards by ethereum address, nil for inactive/slashed users
epoch-conf.json       # autogenerated config file based on your input config file
reporter-db.json      # Full breakdown of all generated data. Can be readable by TinyDB
```

You can then generate the merkle tree file with:

```sh
make tree
```

This will output a `merkle-tree.json` file in the reports folder for your passed epoch.

You will be asked whether to post to IPFS. If you want to do this, you will need to follow the instructions below before building the merkle tree.

## Posting to IPFS

You can use [Web.storage](https://web3.storage/tokens/) to create an API Key.

Add it to a `.env` file by copying the `.env.example` and adding your key.

That's it! Just follow the instructions in the command prompt and you will automatically post to the IPFS and generate a link.

## Issues

Hop on over to the AUXO discord, [or contact me on github](https://github.com/jordaniza)

[] Make xAUXO redistribution only to active stakers
[] Active/Inactive to Staked/NonStaked for XAuxo

Scenario 1:

- All stakers get (rewards - haircut)
- Haircut -> DAO (just make a note of it)
- NonStaked xAUXO gets redistributed
  - this could go to the DAO (doesn't move)
  - could go to someone else according to weights
    - should we transfer or merkle distribute?

eg. 20% buyback, 50% existing stakers, 30% Ops

Name Changes:

- Deploy contracts (maybe)
- Test Staking xAUXO
  - Changing Epochs
- Generating Rewards Tree
- Test Staking veAUXO (voting?)
- Generating Rewards Tree
- Deploying to a Distributor
- Claiming

Scenario

4 veAUXO Stakers:

1. Active on chain
2. Active on snapshot
3. Inactive
4. Active on both

**Setup**
Each receive 100 AUXO and convert to 100 veAUXO

We need to create a mock snapshot vote for veAUXO
We need a mock onchain vote

Then we can combine in the reporter against an expected outcome

**xAUXO**
4 more stakers each receive 100 veAUXO -> xAUXO

Set the Tax/Haircut at 20%

xAUXO globally has 400 veAUXO across the 4 stakers

Only the first 2 are staked

From the redistributions:
All of it gets assigned to a 5th Wallet that is not related to anyone else here

```json
{
  "weight": 1,
  "option": "transfer",
  "address": "0x123..."
}
```

Assuming this works - we add the decay logic
